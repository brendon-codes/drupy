<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>base.includes.database</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="base-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="base-module.html">Package&nbsp;base</a> ::
        <a href="base.includes-module.html">Package&nbsp;includes</a> ::
        Module&nbsp;database
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module database</h1><p class="nomargin-top"><span class="codelink"><a href="base.includes.database-pysrc.html">source&nbsp;code</a></span></p>
Wrapper for database interface code.

<hr />
<div class="fields">      <dl><dt>See Also:</dt>
        <dd>
          <a href='http://drupy.net'>Drupy Homepage</a>,
          <a href='http://drupal.org'>Drupal Homepage</a>
        </dd>
      </dl>
      <strong>Notes:</strong>
      <ul class="nomargin-top">
        <li>
        Drupy is a port of the Drupal project.
        </li>
        <li>
        This file was ported from Drupal's includes/database.inc
        </li>
        <li>
        License:

  This program is free software; you can redistribute it and/or
  modify it under the terms of the GNU General Public License
  as published by the Free Software Foundation; either version 2
  of the License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program; if not, write to:
  
  The Free Software Foundation, Inc.,
  51 Franklin Street, Fifth Floor,
  Boston, MA  02110-1301,
  USA
        </li>
      </ul>
      <p><strong>Author:</strong>
        Brendon Crawford
      </p>
      <p><strong>Copyright:</strong>
        2008 Brendon Crawford
      </p>
      <p><strong>Contact:</strong>
        message144 at users dot sourceforge dot net
      </p>
      <p><strong>Version:</strong>
        0.1
      </p>
</div><!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Functions</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Functions"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="base.includes.database-module.html#update_sql" class="summary-sig-name">update_sql</a>(<span class="summary-sig-arg">sql</span>)</span><br />
      Allow the use of different database servers using the same code base.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="base.includes.database-pysrc.html#update_sql">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="base.includes.database-module.html#db_prefix_tables" class="summary-sig-name">db_prefix_tables</a>(<span class="summary-sig-arg">sql</span>)</span><br />
      Append a database prefix to all tables in a query.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="base.includes.database-pysrc.html#db_prefix_tables">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="base.includes.database-module.html#db_set_active" class="summary-sig-name">db_set_active</a>(<span class="summary-sig-arg">name</span>=<span class="summary-sig-default"><code class="variable-quote">'</code><code class="variable-string">default</code><code class="variable-quote">'</code></span>)</span><br />
      Activate a database for future queries.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="base.includes.database-pysrc.html#db_set_active">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="base.includes.database-module.html#_db_error_page" class="summary-sig-name" onclick="show_private();">_db_error_page</a>(<span class="summary-sig-arg">error</span>=<span class="summary-sig-default"><code class="variable-quote">'</code><code class="variable-string"></code><code class="variable-quote">'</code></span>)</span><br />
      Helper function to show fatal database errors.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="base.includes.database-pysrc.html#_db_error_page">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="db_is_active"></a><span class="summary-sig-name">db_is_active</span>()</span><br />
      Returns a boolean depending on the availability of the database.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="base.includes.database-pysrc.html#db_is_active">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_db_query_callback"></a><span class="summary-sig-name">_db_query_callback</span>(<span class="summary-sig-arg">match</span>,
        <span class="summary-sig-arg">init</span>=<span class="summary-sig-default">False</span>)</span><br />
      Helper function for db_query().</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="base.includes.database-pysrc.html#_db_query_callback">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="base.includes.database-module.html#db_placeholders" class="summary-sig-name">db_placeholders</a>(<span class="summary-sig-arg">arguments</span>,
        <span class="summary-sig-arg">type</span>=<span class="summary-sig-default"><code class="variable-quote">'</code><code class="variable-string">int</code><code class="variable-quote">'</code></span>)</span><br />
      Generate placeholders for an array of query arguments of a single type.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="base.includes.database-pysrc.html#db_placeholders">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== VARIABLES ==================== -->
<a name="section-Variables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Variables</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Variables"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="active_db"></a><span class="summary-name">active_db</span> = <code title="&lt;_mysql.connection open to 'localhost' at 965a10&gt;">&lt;_mysql.connection open to 'localhost' at 965a10&gt;</code>
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="DB_ERROR"></a><span class="summary-name">DB_ERROR</span> = <code title="'a515ac9c2796ca0e23adbe92c68fc9fc'"><code class="variable-quote">'</code><code class="variable-string">a515ac9c2796ca0e23adbe92c68fc9fc</code><code class="variable-quote">'</code></code>
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="DB_QUERY_REGEXP"></a><span class="summary-name">DB_QUERY_REGEXP</span> = <code title="'/(%d|%s|%%|%f|%b)/'"><code class="variable-quote">'</code><code class="variable-string">/(%d|%s|%%|%f|%b)/</code><code class="variable-quote">'</code></code>
    </td>
  </tr>
</table>
<!-- ==================== FUNCTION DETAILS ==================== -->
<a name="section-FunctionDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Function Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-FunctionDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="update_sql"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">update_sql</span>(<span class="sig-arg">sql</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="base.includes.database-pysrc.html#update_sql">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Allow the use of different database servers using the same code base.

Drupal provides a slim database abstraction layer to provide developers with
the ability to support multiple database servers easily. The intent of this
layer is to preserve the syntax and power of SQL as much as possible, while
letting Drupal control the pieces of queries that need to be written
differently for different servers and provide basic security checks.

Most Drupal database queries are performed by a call to db_query() or
db_query_range(). Module authors should also consider using pager_query() for
queries that return results that need to be presented on multiple pages, and
tablesort_sql() for generating appropriate queries for sortable tables.

For example, one might wish to return a list of the most recent 10 nodes
authored by a given user. Instead of directly issuing the SQL query
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>sql</code></strong> - A string containing a complete SQL query.  %-substitution
  parameters are not supported.</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>An array containing the keys:
     success: a boolean indicating whether the query succeeded
     query: the SQL query executed, passed through check_plain()</dd>
  </dl>
</td></tr></table>
</div>
<a name="db_prefix_tables"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">db_prefix_tables</span>(<span class="sig-arg">sql</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="base.includes.database-pysrc.html#db_prefix_tables">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Append a database prefix to all tables in a query.

Queries sent to Drupal should wrap all table names in curly brackets. This
function searches for this syntax and adds Drupal's table prefix to all
tables, allowing Drupal to coexist with other systems in the same database if
necessary.
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>sql</code></strong> - A string containing a partial or entire SQL query.</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>The properly-prefixed string.</dd>
  </dl>
</td></tr></table>
</div>
<a name="db_set_active"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">db_set_active</span>(<span class="sig-arg">name</span>=<span class="sig-default"><code class="variable-quote">'</code><code class="variable-string">default</code><code class="variable-quote">'</code></span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="base.includes.database-pysrc.html#db_set_active">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Activate a database for future queries.

If it is necessary to use external databases in a project, this function can
be used to change where database queries are sent. If the database has not
yet been used, it is initialized using the URL specified for that name in
Drupal's configuration file. If this name is not defined, a duplicate of the
default connection is made instead.

Be sure to change the connection back to the default when done with custom
code.
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>name</code></strong> - The name assigned to the newly active database connection. If omitted, the
  default connection will be made active.</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>the name of the previously active database or FALSE if non was found.</dd>
  </dl>
<div class="fields">      <p><strong>To Do:</strong>
        BC: Need to eventually resolve the database importing mechanism here
right now we are statically loading mysql at the top, but eventually we need
to get this figured out
      </p>
</div></td></tr></table>
</div>
<a name="_db_error_page"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_db_error_page</span>(<span class="sig-arg">error</span>=<span class="sig-default"><code class="variable-quote">'</code><code class="variable-string"></code><code class="variable-quote">'</code></span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="base.includes.database-pysrc.html#_db_error_page">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Helper function to show fatal database errors.

Prints a themed maintenance page with the 'Site off-line' text,
adding the provided error message in the case of 'display_errors'
set to on. Ends the page request; no return.
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>error</code></strong> - The error message to be appended if 'display_errors' is on.</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="db_placeholders"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">db_placeholders</span>(<span class="sig-arg">arguments</span>,
        <span class="sig-arg">type</span>=<span class="sig-default"><code class="variable-quote">'</code><code class="variable-string">int</code><code class="variable-quote">'</code></span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="base.includes.database-pysrc.html#db_placeholders">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Generate placeholders for an array of query arguments of a single type.

Given a Schema API field type, return correct %-placeholders to
embed in a query
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>arguments</code></strong> - An array with at least one element.</li>
        <li><strong class="pname"><code>type</code></strong> - The Schema API type of a field (e.g. 'int', 'text', or 'varchar').</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="base-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Fri Jun 27 18:26:11 2008
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
